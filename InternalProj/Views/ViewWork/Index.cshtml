@model InternalProj.ViewModel.WorkOrderViewModel

@{
    ViewBag.Title = "View Work Orders";
    var slno = (Model.CurrentPage - 1) * 10 + 1;
}

@section Styles {
    <link rel="stylesheet" href="~/css/Invoice.css" asp-append-version="true" />
}

<div class="container d-flex justify-content-center align-items-center">
    <div class="card shadow p-4 w-100">
        <h3 class="text-center">Work Order Details</h3>
        <div class="custom-form-wrapper">

            <form asp-action="Search" method="post" class="filter-form mb-4">
                <div class="row align-items-end">

                    <div class="form-group col-md-2">
                        <label for="studio" class="form-label">Studio</label>
                        <select id="studio" name="studio" class="form-control">
                            <option value="">-- Select Studio --</option>
                            @foreach (var studio in Model.StudioList)
                            {
                                var isSelected = studio == Model.StudioFilter ? "selected" : "";
                                @Html.Raw($"<option value=\"{studio}\" {isSelected}>{studio}</option>")
                            }
                        </select>
                    </div>

                    <div class="form-group col-md-2">
                        <label for="fromDate" class="form-label">From Date</label>
                        <input type="date" id="fromDate" name="fromDate" class="form-control" value="@(Model.FromDateFilter?.ToString("yyyy-MM-dd"))" />
                    </div>

                    <div class="form-group col-md-2">
                        <label for="toDate" class="form-label">To Date</label>
                        <input type="date" id="toDate" name="toDate" class="form-control" value="@(Model.ToDateFilter?.ToString("yyyy-MM-dd"))" />
                    </div>

                    <div class="form-group col-md-2">
                        <label for="workTypeId" class="form-label">Work Type</label>
                        <select asp-for="WorkTypeFilter" class="form-control" asp-items="@(new SelectList(Model.WorkTypes, "WorkTypeId", "TypeName"))">
                            <option value="">-- Select --</option>
                        </select>
                    </div>

                    <div class="form-group col-md-2">
                        <div class="button-group">
                            <button class="search" type="submit">Search</button>
                            <a href="@Url.Action("Index", "ViewWork")" class="btn-refresh">Refresh</a>
                        </div>
                    </div>

                </div>
            </form>

            @if (Model.ResultsSummary != null && Model.ResultsSummary.Any())
            {
                <table class="workorder-table">
                    <thead>
                        <tr>
                            <th>Sl No</th>
                            <th>Work Order No</th>
                            <th>Studio Name</th>
                            <th>Work Type</th>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Advance</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.ResultsSummary)
                        {
                            <tr>
                                <td>@(slno++)</td>
                                <td>
                                    <a href="#" class="workorder-link" data-id="@item.WorkOrderId">
                                        @item.WorkOrderNo
                                    </a>
                                </td>

                                <td>@item.StudioName</td>
                                <td>@item.WorkTypeName</td>
                                <td>@item.Wdate?.ToString("dd-MM-yyyy")</td>
                                <td>@item.SubTotal.ToString("N2")</td>
                                <td>@item.Advance.ToString("N2")</td>
                                <td>@item.Balance.ToString("N2")</td>
                            </tr>
                        }
                    </tbody>
                </table>

                @if (Model.TotalPages > 1)
                {
                    <div class="pagination-container">
                        <form asp-action="Index" method="get" class="pagination-form">

                            <input type="hidden" name="studio" value="@Model.StudioFilter" />
                            <input type="hidden" name="fromDate" value="@Model.FromDateFilter?.ToString("yyyy-MM-dd")" />
                            <input type="hidden" name="toDate" value="@Model.ToDateFilter?.ToString("yyyy-MM-dd")" />
                            <input type="hidden" name="workTypeId" value="@Model.WorkTypeFilter" />
                            <input type="hidden" name="isSearch" value="true" />

                            <div class="pagination-buttons">
                                @if (Model.CurrentPage > 1)
                                {
                                    <button name="currentPage" value="@(Model.CurrentPage - 1)" class="pagination-btn">&lt;</button>
                                }

                                <button name="currentPage" value="1" class="pagination-btn @(Model.CurrentPage == 1 ? "active" : "")">1</button>

                                @if (Model.CurrentPage > 3)
                                {
                                    <span class="dots">...</span>
                                }

                                @for (int i = Math.Max(2, Model.CurrentPage - 1); i <= Math.Min(Model.TotalPages - 1, Model.CurrentPage + 1); i++)
                                {
                                    <button name="currentPage" value="@i" class="pagination-btn @(i == Model.CurrentPage ? "active" : "")">@i</button>
                                }

                                @if (Model.CurrentPage < Model.TotalPages - 2)
                                {
                                    <span class="dots">...</span>
                                }

                                @if (Model.TotalPages > 1)
                                {
                                    <button name="currentPage" value="@Model.TotalPages" class="pagination-btn @(Model.CurrentPage == Model.TotalPages ? "active" : "")">@Model.TotalPages</button>
                                }

                                @if (Model.CurrentPage < Model.TotalPages)
                                {
                                    <button name="currentPage" value="@(Model.CurrentPage + 1)" class="pagination-btn">&gt;</button>
                                }
                            </div>
                        </form>
                    </div>
                }

            }
            else
            {
                <p>No records found.</p>
            }

        </div>
    </div>
</div>

<div id="workOrderModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Work Order Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Content loads here -->
            </div>
        </div>
    </div>
</div>

<!-- Load jQuery first -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Then your custom script -->
<script>
    $(document).ready(function () {
      $('.workorder-link').on('click', function (e) {
        e.preventDefault();
        const id = $(this).data('id');
        $('#workOrderModal .modal-body').html('Loading...');

        $.get('@Url.Action("GetWorkOrderDetails", "WorkOrder")', { id: id })
          .done(function(data) {
            $('#workOrderModal .modal-body').html(data);
            new bootstrap.Modal($('#workOrderModal')).show();
          })
          .fail(function() {
            $('#workOrderModal .modal-body').html(
              '<p class="text-danger">Error loading details.</p>'
            );
          });
      });
    });
</script>




<style>
    /* Global page styles */
    body {
        color: #333;
        font: 13px;
    }

    h3 {
        font-weight: 500;
        margin-bottom: 10px;
        color: #222;
    }

    /* Form styling */
    .filter-form {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
        align-items: flex-end;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        min-width: 150px;
        max-width: 320px;
    }

    label {
        font-weight: 600;
        margin-bottom: 6px;
        color: #444;
    }

    input[type="text"],
    input[type="date"],
    select {
        padding: 8px 10px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
        transition: border-color 0.3s ease;
    }

        input[type="text"]:focus,
        input[type="date"]:focus,
        select:focus {
            border-color: #4a0357;
            outline: none;
        }

    button {
        padding: 10px 20px;
        font-size: 14px;
        background-color: #4a0357;
        border: none;
        color: white;
        border-radius: 10px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        align-self: center;
        font-weight: 500;
    }

        button:hover {
            background-color: #9007a8;
            color: white;
        }

    /* Table styling */
    .workorder-table {
        width: 100%;
        border-collapse: collapse;
        box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
        background-color: white;
        font-size: 13px;
    }

        .workorder-table th,
        .workorder-table td {
            border: 1px solid #ddd;
            padding: 8px 10px;
            text-align: left;
        }

        .workorder-table thead {
            background-color: #64126b;
            color: white;
            font-weight: 600;
        }

        .workorder-table tbody tr:hover {
            background-color: #f1f7ff;
        }

    /* Responsive for small screens */
    @@media (max-width: 700px) {
        .filter-form {
            flex-direction: column;
            align-items: stretch;
        }

        .form-group {
            max-width: 100%;
        }

        button {
            width: 100%;
        }
    }

    .btn-refresh {
        padding: 10px 20px;
        text-decoration: none;
        font-size: 14px;
        background-color: #07ad33;
        border: none;
        color: white;
        border-radius: 10px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        align-self: center;
        font-weight: 500;
    }

        .btn-refresh:hover {
            background-color: #248c40;
            color: white;
        }


    /* .button-cont{
            display: flex;
        } */

    .pagination-container {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        margin-bottom: 40px;
    }

    .pagination-form {
        display: flex;
        flex-wrap: wrap;
    }

    .pagination-buttons {
        display: flex;
        gap: 6px;
        align-items: center;
        padding: 4px 10px;
    }

    .pagination-btn {
        padding: 6px 16px;
        background-color: white;
        border: 1px solid #64126b;
        border-radius: 20px;
        color: #64126b;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

        .pagination-btn:hover {
            background-color: #64126b;
            color: white;
        }

        .pagination-btn.active {
            background-color: #64126b;
            color: white;
            font-weight: bold;
        }

    .dots {
        padding: 6px;
        font-weight: bold;
        color: #999;
    }

    .button-group {
        display: flex;
        gap: 15px;
        align-items: center;
    }
</style>
