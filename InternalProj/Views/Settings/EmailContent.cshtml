@model string

<h3>Email Content Settings</h3>

<div id="inner-content">
    <form id="emailContentForm">
        <div class="form-group">
            <label>Email Content</label>
            <textarea name="content" id="emailContent" class="form-control" rows="6">@Model</textarea>
        </div>
        <button type="submit" class="btn btn-primary mt-2">Save</button>

        <!-- ✅ Message span placed near Save button -->
        <span id="emailMessage" class="ms-3"></span>
    </form>
</div>

<script>
    document.getElementById("emailContentForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const content = document.getElementById("emailContent").value;
        const messageSpan = document.getElementById("emailMessage");

        fetch("/Settings/UpdateEmailContent", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ content })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                // ✅ FIXED: wrap as string
                messageSpan.innerHTML = `<span class="text-success">Email content has been successfully saved.</span>`;

                // Reload only the textarea value
                fetch("/Settings/EmailContent")
                    .then(response => response.text())
                    .then(html => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, "text/html");
                        const newTextarea = doc.querySelector("#emailContent");
                        document.querySelector("#emailContent").value = newTextarea.value;
                    });

            } else {
                messageSpan.innerHTML = `<span class="text-danger">${data.message}</span>`;
            }

            // Auto-hide after 5s
            setTimeout(() => { messageSpan.innerHTML = ""; }, 5000);
        })
        .catch(err => {
            messageSpan.innerHTML = `<span class="text-danger">Error saving email content.</span>`;
            console.error("Error:", err);
            setTimeout(() => { messageSpan.innerHTML = ""; }, 5000);
        });
    });
</script>
